<p id="notice"><%= notice %></p>

<% if @reserved_listings.length > 0 || @available_listings.length > 0 %>

  <h1><%= current_user.name %>'s listings</h1>

<% else %>

  <h1><%= current_user.name %> currently has no meals listed.</h1>

<% end %>

<% if @reserved_listings.length > 0 %>

  <h2>Reserved</h2>

  <table class='table'>
    <thead>
      <tr>
        <th></th>
        <th>Title</th>
        <th>Description</th>
        <th>Location</th>
        <th colspan="3"></th>
      </tr>
    </thead>

    <tbody>
      <% @reserved_listings.each do |listing| %>
        <% cache(cache_key_for_listing_row(listing)) do %>
          <tr>
            <td id="reserved_<%= listing.id %>" class="carousel slide" data-ride="carousel">
              <div class="carousel-inner" style="width: 36vw; height: 32vh">
                <ol class="carousel-indicators">
                  <% listing.images.each_with_index do |image, i| %>
                    <li data-target="#reserved_<%= listing.id %>" data-slide-to="<%= i %>" <% if i == 0 %>class="active"<% end %>></li>
                  <% end %>
                </ol>

                <% listing.images.each_with_index do |image, i| %>
                  <% cache(cache_key_for_listing_image_row(image)) do %>
                    <div class="carousel-item <% if i == 0 %>active<% end %> w-100 h-100" >
                      <div class="d-block w-100 h-100">
                        <%= image_tag image, class: 'img-fluid img-thumbnail', style: 'object-fit: cover; width: 100%; height: 100%' %>
                      </div>
                    </div>
                  <% end %>
                <% end %>
              </div>
              <a class="carousel-control-prev" href="#reserved_<%= listing.id %>" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
              </a>
              <a class="carousel-control-next" href="#reserved_<%= listing.id %>" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
              </a>
            </td>

            <td><%= listing.title %></td>
            <td><%= listing.description %></td>
            <td><%= listing.location %></td>
            <td><%= link_to 'Show', listing %></td>
            <td><%= link_to 'Edit', edit_listing_path(listing) %></td>
            <td><%= button_to "Delete", listing, :method => "delete", class: "btn btn-danger" %></td>
          </tr>
        <% end %>
      <% end %>
    </tbody>
  </table>

<% end %>

<% if @available_listings.length > 0 %>

  <h2>Publicly Listed</h2>

  <table class='table'>
    <thead>
      <tr>
        <th></th>
        <th>Title</th>
        <th>Description</th>
        <th>Location</th>
        <th colspan="3"></th>
      </tr>
    </thead>

    <tbody>
      <% @available_listings.each do |listing| %>
        <% cache(cache_key_for_listing_row(listing)) do %>
          <tr>
            <td id="available_<%= listing.id %>" class="carousel slide" data-ride="carousel">
              <div class="carousel-inner" style="width: 36vw; height: 32vh">
                <ol class="carousel-indicators">
                  <% listing.images.each_with_index do |image, i| %>
                    <li data-target="#available_<%= listing.id %>" data-slide-to="<%= i %>" <% if i == 0 %>class="active"<% end %>></li>
                  <% end %>
                </ol>

                <% listing.images.each_with_index do |image, i| %>
                  <% cache(cache_key_for_listing_image_row(image)) do %>
                    <div class="carousel-item <% if i == 0 %>active<% end %> w-100 h-100" >
                      <div class="d-block w-100 h-100">
                        <%= image_tag image, class: 'img-fluid img-thumbnail', style: 'object-fit: cover; width: 100%; height: 100%' %>
                      </div>
                    </div>
                  <% end %>
                <% end %>
              </div>
              <a class="carousel-control-prev" href="#available_<%= listing.id %>" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
              </a>
              <a class="carousel-control-next" href="#available_<%= listing.id %>" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
              </a>
            </td>

            <td><%= listing.title %></td>
            <td><%= listing.description %></td>
            <td><%= listing.location %></td>
            <td><%= link_to 'Show', listing %></td>
            <td><%= link_to 'Edit', edit_listing_path(listing) %></td>
            <td><%= button_to "Delete", listing, :method => "delete", class: "btn btn-danger" %></td>
          </tr>
        <% end %>
      <% end %>
    </tbody>
  </table>

<% end %>

<br>

<%= link_to 'List a New Meal', new_listing_path %>
